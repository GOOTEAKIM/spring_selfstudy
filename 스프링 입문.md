# 6/29

## 커피잔 아이콘이 뜨면서 코드 실행이 안될 때?

- src 우클릭 - Make Directory as - Source Root

## 1. 프로젝트 환경 설정

### 프로젝트 생성

- 스프링 부트 스타터 사이트로 이동해서 스프링 프로젝트 생성
- https://start.spring.io/

- 프로젝트 선택
  - Project: Gradle - Groovy Project
  - Spring Boot: 3.x.x
  - Language: Java
  - Packaging: Jar
  - Java: 17 또는 21

- Project Metadata
  - groupId: hello
  - artifactId: hello-spring

- Dependencies: Spring Web, Thymeleaf

- 스프링 부트 3.0 이상을 선택 할 것
---
### Gradle 전체 설정

```gradle
plugins {
	id 'java'
	id 'org.springframework.boot' version '3.3.1'
	id 'io.spring.dependency-management' version '1.1.5'
}

group = 'hello'
version = '0.0.1-SNAPSHOT'

configurations {
	compileOnly {
		extendsFrom annotationProcessor
	}
}


//java {
//	toolchain {
//		languageVersion = JavaLanguageVersion.of(22)
//	}
//}

repositories {
	mavenCentral()
}


dependencies {
	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'com.github.gavlyukovskiy:p6spy-spring-boot-starter:1.9.0'
	compileOnly 'org.projectlombok:lombok'
	runtimeOnly 'com.h2database:h2'
	annotationProcessor 'org.projectlombok:lombok'
	testImplementation 'org.springframework.boot:spring-boot-starter-test'


	//test 롬복 사용
	testCompileOnly 'org.projectlombok:lombok'
	testAnnotationProcessor 'org.projectlombok:lombok'


	//Querydsl 추가
	implementation 'com.querydsl:querydsl-jpa:5.0.0:jakarta'
	annotationProcessor "com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jakarta"
	annotationProcessor "jakarta.annotation:jakarta.annotation-api"
	annotationProcessor "jakarta.persistence:jakarta.persistence-api"
}


tasks.named('test') {
	useJUnitPlatform()
}


clean {
	delete file('src/main/generated')
}

```

- 동작 확인
  - 기본 메인 클래스 실행
  - 스프링 부트 메인 실행 후 에러페이지로 간단하게 동작 확인( http://localhost:8080 )
---
### View 환경설정

- src/main/resources/static/index.html

	```html
	<!DOCTYPE HTML>
	<html>
	<head>
	<title>Hello</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	</head>
	<body>
	Hello
	<a href="/hello">hello</a>
	</body>
	</html>
	```

- src/main/resources/templates/hello.html

	```html
	<!DOCTYPE HTML>
	<html xmlns:th="http://www.thymeleaf.org">
	<head>
			<title>Hello</title>
			<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	</head>
	<body>
	<p th:text="'안녕하세요. ' + ${data}" >안녕하세요. 손님</p>
	</body>
	</html>
	```

- src/main/main/java/hello.hello_spring/controller/HelloController

	```java
	package hello.hello_spring.controller;

	import org.springframework.stereotype.Controller;
	import org.springframework.ui.Model;
	import org.springframework.web.bind.annotation.GetMapping;

	@Controller
	public class HelloController {
			@GetMapping("hello")
			public String hello(Model model) {
					model.addAttribute("data", "hello!");
					return "hello";
			}
	}
	```

- 서버 실행
- http://localhost:8080/ 에서 글자가 나오는지 확인
- http://localhost:8080/hello 에서 글자가 나오는지 확인
- 설정 완료
---
### 빌드

- 빌드를 바로 하면 일단 JAVA_HOME 이 없다고 나온다

1. 윈도우에서 `시스템 변수 환경 편집` 실행.
2. 환경변수
3. 사용자 변수 새로 만들기
	- 변수 이름 : JAVA_HOME
	- 변수 값 : C:\Program Files\JetBrains\IntelliJ IDEA Community Edition 2024.1.2\jbr
4. 시스텝 변수
	- Path 편집
  	- 새로 만들기 : %JAVA_HOME%\bin
5. ./gradlew build 
6. 빌드 완료

---

# 7/1

## 2. 스프링 웹 개발 기초

### Thymeleaf 가 작동 안할때

1. src/main/resources/application.properties 파일 확인

	```properties
	spring.thymeleaf.prefix=classpath:/templates/
	spring.thymeleaf.suffix=.html
	spring.thymeleaf.enabled=true
	```
2. 해당 코드 추가
3. 빌드 실행 (`./gradlew build`)
---

### MVC 와 템플릿 엔진

- Controller

	```java
	@Controller
	public class HelloController {
			@GetMapping("hello-mvc")
			public String helloMvc(@RequestParam("name") String name, Model model) {
					model.addAttribute("name", name);
					return "hello-template";
			}
	}
	```

- View (resources/templates/hello-template.html)

```html
<html xmlns:th="http://www.thymeleaf.org">
<body>
<p th:text="'hello ' + ${name}">hello! empty</p>
</body>
</html>
```

- 실행
  - http://localhost:8080/hello-mvc?name=spring
---
### API

- @ResponseBody 문자 반환

	```java
	@Controller
	public class HelloController {

			@GetMapping("hello-string")
			@ResponseBody
			
			public String helloString(@RequestParam("name") String name) {
					return "hello " + name;
			}
	}
	```

	- `@ResponseBody` 를 사용하면 뷰 리졸버( viewResolver )를 사용하지 않음
	- 대신에 HTTP의 BODY에 문자 내용을 직접 반환

- 실행
  - http://localhost:8080/hello-string?name=spring

---

- @ResponseBody 객체 반환

```java
@Controller
public class HelloController {
		@GetMapping("hello-api")
		@ResponseBody

		public Hello helloApi(@RequestParam("name") String name) {
				Hello hello = new Hello();
				hello.setName(name);
				return hello;
		}

		static class Hello {
				private String name;
				public String getName() {
						return name;
				}

				public void setName(String name) {
						this.name = name;
				}
		}
}
```

- @ResponseBody 를 사용하고, 객체를 반환하면 객체가 `JSON`으로 변환됨

- 실행
	- http://localhost:8080/hello-api?name=spring

---

# 7/2

## 3. 회원 관리 예제

### 회원 도메인과 리포지토리 만들기

	```java
	private Long id;
	private String name;
	```
	- alt + insert -> getter and setter

	- 테스트를 한번하면 깨끗하게 해줘야한다.
---
### 회원 리포지토리 테스트 케이스 작성

- test/java/hello.hello_spring/폴더명

- 이 경로로 테스트 package 생성
- 클래스 이름 = 테스트 할 클래스 + Test
	- ex. MemoryMemberRepository + Test = `MemoryMemberRepositoryTest`
- public 으로 안만들어도 된다.
- 메서드 사용 전에 `@Test` 작성해줘야 한다.

- Assertions (org.junit.jupiter.api) 사용해야 한다.

- @AfterEach : 각 테스트가 종료될 때 마다 이 기능을 실행한다.
  - 테스트는 각각 독립적으로 실행되어야 한다. 
  - 테스트 순서에 의존관계가 있는 것은 좋은 테스트가 아니다.

- alt + enter -> replace static import : static import 추출
- shift + F6 : rename 
---

### 회원 서비스 개발

- alt + insert : constructor 생성
- ctrl + alt + l : 코드 정리
- ctrl + alt + shift + t -> extract method
- ctrl + alt + v : 리턴을 해주는 대상 생성
- ctrl + alt + shift + t : 여러가지 단축어 보여줌
  - extract method : 새로운 메서드로 만들 수 있다

---

### 회원 서비스 테스트

- ctrl + shift + T : 테스트 자동으로 생성
- 테스트 명은 한글로 바꿔도 상관없다.
- 